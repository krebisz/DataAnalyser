<Window x:Class="DataVisualiser.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
        Title="Health Data Viz"
        SizeToContent="Height"
        Width="1800"
        FontSize="10"
        Background="#FFD4CFCF">

    <DockPanel>

        <!-- ====== TOP CONTROL AREA (Two Rows) ====== -->
        <Border DockPanel.Dock="Top" Background="#FF747171" Padding="5">
            <StackPanel Orientation="Vertical">
                <!-- ====== TOP CONTROL BAR (Row 1) ====== -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
            <Label Content="Resolution:" VerticalAlignment="Center" Margin="5,0"/>
            <ComboBox x:Name="ResolutionCombo" Width="120" Margin="5"
                      IsEditable="False"
                      SelectionChanged="OnResolutionSelectionChanged"/>

            <Label Content="Metric Type:" VerticalAlignment="Center" Margin="5,0"/>
            <ComboBox x:Name="TablesCombo" Width="300" Margin="5"
                      IsEditable="False"
                      SelectionChanged="OnMetricTypeSelectionChanged"/>

            <Label Content="From:" VerticalAlignment="Center" Margin="5,0"/>
            <DatePicker x:Name="FromDate"
                        SelectedDateChanged="OnFromDateChanged"
                        Width="150"
                        Margin="5"/>

            <Label Content="To:" VerticalAlignment="Center" Margin="5,0"/>
            <DatePicker x:Name="ToDate"
                        SelectedDateChanged="OnToDateChanged"
                        Width="150"
                        Margin="5"/>

            <Button Content="Load Data"
                    Click="OnLoadData"
                    Margin="5"
                    Padding="10,5"/>

            <Separator Margin="10,0"/>

            <Button Content="Reset Zoom"
                    Click="OnResetZoom"
                    Margin="5"
                    Padding="10,5"/>
        </StackPanel>

                <!-- ====== SUBTYPE PANEL (Row 2) ====== -->
                <StackPanel Orientation="Horizontal"
                            Name="MetricSubtypePanel"
                            Margin="5">

            <Label Content="Metric Subtype 1:"
                   VerticalAlignment="Center"
                   Margin="5,0"/>

            <ComboBox x:Name="SubtypeCombo"
                      Width="250"
                      Margin="5"
                      IsEditable="False"
                      IsEnabled="False"/>

            <Button Content="Add Subtype"
                    Click="AddSubtypeComboBox"
                    Margin="5"
                    Padding="10,5"/>
        </StackPanel>
            </StackPanel>
        </Border>

        <!-- ====== SCROLL VIEWER ====== -->
        <ScrollViewer Margin="5"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">

            <!-- ========= STACKPANEL MAIN ========= -->
            <StackPanel x:Name="StackPanelMain"
                        Orientation="Vertical">

                <!-- ========== CHART MAIN ========== -->
                <Border BorderBrush="#FF444444"
                        BorderThickness="1"
                        Margin="0,0,0,10">

                    <StackPanel Orientation="Vertical" Margin="0,0,0,10">

                        <Border Background="#BB131313"
                                BorderBrush="#FF444444"
                                BorderThickness="1"
                                Padding="10,5">

                            <StackPanel Orientation="Horizontal" Margin="20,5,10,0">
                                <TextBlock x:Name="ChartMainTitle"
                                           Text="ChartMain"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           VerticalAlignment="Center"/>

                                <Button x:Name="ChartMainToggleButton"
                                        Content="Show"
                                        Margin="10,0,0,0"
                                        Padding="10,3"
                                        Click="OnChartMainToggle"/>
                            </StackPanel>
                        </Border>

                        <StackPanel x:Name="ChartMainPanel" Orientation="Vertical">
                            <lvc:CartesianChart x:Name="ChartMain"
                                                LegendLocation="Right"
                                                Zoom="X"
                                                Pan="X"
                                                Hoverable="True"
                                                Margin="20,5,10,20"
                                                MinHeight="500">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Title="Time"/>
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis Title="Value"
                                              ShowLabels="True"/>
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                        </StackPanel>

                    </StackPanel>
                </Border>

                <!-- ========== CHART NORMALIZED ========== -->
                <Border BorderBrush="#FF444444"
                        BorderThickness="1"
                        Margin="0,0,0,10">

                    <StackPanel Orientation="Vertical" Margin="0,0,0,10">

                        <Border Background="#BB131313"
                                BorderBrush="#FF444444"
                                BorderThickness="1"
                                Padding="10,5">

                            <StackPanel Orientation="Horizontal" Margin="20,5,10,0">
                                <TextBlock x:Name="ChartNormTitle"
                                           Text="ChartNorm"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           VerticalAlignment="Center"/>

                                <Button x:Name="ChartNormToggleButton"
                                        Content="Show"
                                        Margin="10,0,0,0"
                                        Padding="10,3"
                                        Click="OnChartNormToggle"/>
                            </StackPanel>
                        </Border>

                        <StackPanel Orientation="Horizontal" Margin="40,5,10,0">
                            <TextBlock Text="Normalization:"
                                       VerticalAlignment="Center"
                                       Margin="0,0,10,0"/>

                            <RadioButton x:Name="NormZeroToOneRadio"
                                         Content="Zeroâ€“One"
                                         Margin="5,0"
                                         GroupName="NormModes"
                                         Checked="OnNormalizationModeChanged"/>

                            <RadioButton x:Name="NormPercentOfMaxRadio"
                                         Content="% of Max"
                                         Margin="5,0"
                                         GroupName="NormModes"
                                         IsChecked="True"
                                         Checked="OnNormalizationModeChanged"/>

                            <RadioButton x:Name="NormRelativeToMaxRadio"
                                         Content="Relative to Max"
                                         Margin="5,0"
                                         GroupName="NormModes"
                                         Checked="OnNormalizationModeChanged"/>
                        </StackPanel>

                        <StackPanel x:Name="ChartNormPanel" Orientation="Vertical">
                            <lvc:CartesianChart x:Name="ChartNorm"
                                                LegendLocation="Right"
                                                Zoom="X"
                                                Pan="X"
                                                Hoverable="True"
                                                Margin="20,5,10,20"
                                                MinHeight="400">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Title="Time"/>
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis Title="Relative"
                                              ShowLabels="True"/>
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                        </StackPanel>

                    </StackPanel>
                </Border>

                <!-- ========== CHART DIFFERENCE / RATIO (UNIFIED) ========== -->
                <Border BorderBrush="#FF444444"
                        BorderThickness="1"
                        Margin="0,0,0,10">

                    <StackPanel Orientation="Vertical" Margin="0,0,0,10">

                        <Border Background="#BB131313"
                                BorderBrush="#FF444444"
                                BorderThickness="1"
                                Padding="10,5">

                            <StackPanel Orientation="Horizontal" Margin="20,5,10,0">
                                <TextBlock x:Name="ChartDiffRatioTitle"
                                           Text="Difference / Ratio"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           VerticalAlignment="Center"/>

                                <Button x:Name="ChartDiffRatioToggleButton"
                                        Content="Show"
                                        Margin="10,0,0,0"
                                        Padding="10,3"
                                        Click="OnChartDiffRatioToggle"/>

                                <Button x:Name="ChartDiffRatioOperationToggleButton"
                                        Content="/"
                                        Margin="20,0,0,0"
                                        Padding="10,3"
                                        VerticalAlignment="Center"
                                        Click="OnChartDiffRatioOperationToggle"
                                        ToolTip="Toggle between Difference (-) and Ratio (/)"/>
                            </StackPanel>
                        </Border>

                        <StackPanel x:Name="ChartDiffRatioPanel" Orientation="Vertical">
                            <lvc:CartesianChart x:Name="ChartDiffRatio"
                                                LegendLocation="Right"
                                                Zoom="X"
                                                Pan="X"
                                                Hoverable="True"
                                                Margin="20,5,10,20"
                                                MinHeight="400">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Title="Time"/>
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis x:Name="ChartDiffRatioAxisY"
                                              Title="Difference"
                                              ShowLabels="True"/>
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                        </StackPanel>

                    </StackPanel>
                </Border>

                <!-- ========== CHART WEEKDAY TREND ========== -->
                <Border BorderBrush="#FF444444"
                        BorderThickness="1"
                        Margin="0,0,0,10">

                    <StackPanel Orientation="Vertical" Margin="0,0,0,10">

                        <Border Background="#BB131313"
                                BorderBrush="#FF444444"
                                BorderThickness="1"
                                Padding="10,5">

                            <StackPanel Orientation="Horizontal" Margin="20,5,10,0">
                                <TextBlock x:Name="ChartWeekdayTrendTitle"
                                           Text="Weekday Trends"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           VerticalAlignment="Center"/>

                                <Button x:Name="ChartWeekdayTrendToggleButton"
                                        Content="Show"
                                        Margin="10,0,0,0"
                                        Padding="10,3"
                                        Click="OnChartWeekdayTrendToggle"/>
                            </StackPanel>
                        </Border>

                        <StackPanel Orientation="Horizontal" Margin="40,5,10,0">
                            <TextBlock Text="Days:"
                                       VerticalAlignment="Center"
                                       Margin="0,0,10,0"/>

                            <CheckBox Content="Mon" IsChecked="True" Margin="5,0"
                                      Click="OnWeeklyTrendMondayToggled"/>
                            <CheckBox Content="Tue" IsChecked="True" Margin="5,0"
                                      Click="OnWeeklyTrendTuesdayToggled"/>
                            <CheckBox Content="Wed" IsChecked="True" Margin="5,0"
                                      Click="OnWeeklyTrendWednesdayToggled"/>
                            <CheckBox Content="Thu" IsChecked="True" Margin="5,0"
                                      Click="OnWeeklyTrendThursdayToggled"/>
                            <CheckBox Content="Fri" IsChecked="True" Margin="5,0"
                                      Click="OnWeeklyTrendFridayToggled"/>
                            <CheckBox Content="Sat" IsChecked="True" Margin="5,0"
                                      Click="OnWeeklyTrendSaturdayToggled"/>
                            <CheckBox Content="Sun" IsChecked="True" Margin="5,0"
                                      Click="OnWeeklyTrendSundayToggled"/>

                            <Button x:Name="ChartWeekdayTrendTypeToggleButton"
                                    Content="Polar"
                                    Margin="20,0,0,0"
                                    Padding="10,3"
                                    VerticalAlignment="Center"
                                    Click="OnChartWeekdayTrendTypeToggle"
                                    ToolTip="Toggle between Cartesian and Polar chart"/>
                        </StackPanel>

                        <StackPanel x:Name="ChartWeekdayTrendPanel" Orientation="Vertical">
                            <lvc:CartesianChart x:Name="ChartWeekdayTrend"
                                                LegendLocation="Right"
                                                Zoom="X"
                                                Pan="X"
                                                Hoverable="True"
                                                Margin="20,5,10,20"
                                                MinHeight="400">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Title="Time"/>
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis Title="Value"
                                              ShowLabels="True"/>
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                            <lvc:CartesianChart x:Name="ChartWeekdayTrendPolar"
                                                LegendLocation="Right"
                                                Hoverable="True"
                                                Margin="20,5,10,20"
                                                MinHeight="400"
                                                Visibility="Collapsed">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Title="Day of Week"
                                              MinValue="0"
                                              MaxValue="360"/>
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis Title="Value"
                                              ShowLabels="True"/>
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                        </StackPanel>

                    </StackPanel>
                </Border>

                <!-- ========== CHART WEEKLY DISTRIBUTION ========== -->
                <Border BorderBrush="#FF444444"
                        BorderThickness="1"
                        Margin="0,0,0,10">

                    <StackPanel Orientation="Vertical" Margin="0,0,0,10">

                        <Border Background="#BB131313"
                                BorderBrush="#FF444444"
                                BorderThickness="1"
                                Padding="10,5">

                            <StackPanel Orientation="Horizontal" Margin="20,5,10,0">
                                <TextBlock x:Name="ChartWeeklyTitle"
                                           Text="Weekly Distribution"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           VerticalAlignment="Center"/>

                                <Button x:Name="ChartWeeklyToggleButton"
                                        Content="Show"
                                        Margin="10,0,0,0"
                                        Padding="10,3"
                                        Click="OnChartWeeklyToggle"/>
                            </StackPanel>
                        </Border>

                        <StackPanel Orientation="Horizontal" Margin="40,5,10,0">
                            <TextBlock Text="Display Mode:"
                                       VerticalAlignment="Center"
                                       Margin="0,0,10,0"/>

                            <RadioButton x:Name="WeeklyFrequencyShadingRadio"
                                         Content="Frequency Shading"
                                         GroupName="WeeklyDisplayModes"
                                         IsChecked="True"
                                         Checked="OnWeeklyDisplayModeChanged"/>

                            <RadioButton x:Name="WeeklySimpleRangeRadio"
                                         Content="Simple Range"
                                         GroupName="WeeklyDisplayModes"
                                         Checked="OnWeeklyDisplayModeChanged"/>

                            <TextBlock Text="Interval Count:"
                                       VerticalAlignment="Center"
                                       Margin="20,0,10,0"/>

                            <ComboBox x:Name="WeeklyIntervalCountCombo"
                                      Width="80"
                                      VerticalAlignment="Center"
                                      SelectionChanged="OnWeeklyIntervalCountChanged">
                                <ComboBoxItem Content="3" Tag="3"/>
                                <ComboBoxItem Content="5" Tag="5"/>
                                <ComboBoxItem Content="10" Tag="10"/>
                                <ComboBoxItem Content="25" Tag="25" IsSelected="True"/>
                                <ComboBoxItem Content="50" Tag="50"/>
                                <ComboBoxItem Content="100" Tag="100"/>
                            </ComboBox>
                        </StackPanel>

                        <StackPanel x:Name="ChartWeeklyPanel" Orientation="Vertical">
                            <lvc:CartesianChart x:Name="ChartWeekly"
                                                LegendLocation="Right"
                                                Zoom="X"
                                                Pan="X"
                                                Hoverable="True"
                                                Margin="20,5,10,20"
                                                MinHeight="400">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Title="Day of Week"
                                              Labels="Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday"/>
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis Title="Value"
                                              ShowLabels="True"/>
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>
                        </StackPanel>

                    </StackPanel>
                </Border>


                <!-- ========== TRANSFORM DATA PANEL ========== -->
                <Border BorderBrush="#FF444444"
                        BorderThickness="1"
                        Margin="0,0,0,10">

                    <StackPanel Orientation="Vertical" Margin="0,0,0,10">

                        <Border Background="#BB131313"
                                BorderBrush="#FF444444"
                                BorderThickness="1"
                                Padding="10,5">

                            <StackPanel Orientation="Horizontal" Margin="20,5,10,0">
                                <TextBlock x:Name="TransformPanelTitle"
                                           Text="Data Transform"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           VerticalAlignment="Center"/>

                                <Button x:Name="TransformPanelToggleButton"
                                        Content="Show"
                                        Margin="10,0,0,0"
                                        Padding="10,3"
                                        Click="OnTransformPanelToggle"/>
                            </StackPanel>
                        </Border>

                        <StackPanel x:Name="TransformPanel" Orientation="Vertical" Visibility="Collapsed">
                            <StackPanel Orientation="Horizontal" Margin="20,10">
                                <!-- Operation Selection -->
                                <StackPanel Orientation="Vertical" Margin="0,0,20,0" MinWidth="150">
                                    <TextBlock Text="Operation:" FontWeight="Bold" Margin="0,0,0,5"/>
                                    <ComboBox x:Name="TransformOperationCombo" 
                                              SelectionChanged="OnTransformOperationChanged"
                                              MinWidth="120">
                                        <ComboBoxItem Content="Logarithm" Tag="Log"/>
                                        <ComboBoxItem Content="Square Root" Tag="Sqrt"/>
                                        <ComboBoxItem Content="Add (+)" Tag="Add"/>
                                        <ComboBoxItem Content="Subtract (-)" Tag="Subtract"/>
                                    </ComboBox>
                                </StackPanel>

                                <!-- Compute Button -->
                                <Button x:Name="TransformComputeButton"
                                        Content="="
                                        FontSize="20"
                                        FontWeight="Bold"
                                        Padding="15,5"
                                        Margin="10,20,0,0"
                                        Click="OnTransformCompute"
                                        IsEnabled="False"/>
                            </StackPanel>

                            <!-- Data Grids -->
                            <StackPanel Orientation="Horizontal" Margin="20,10">
                                <!-- Grid 1: Primary Data -->
                                <StackPanel Orientation="Vertical" Margin="0,0,10,0" MinWidth="250">
                                    <TextBlock x:Name="TransformGrid1Title" 
                                               Text="Primary Data" 
                                               FontWeight="Bold" 
                                               Margin="0,0,0,5"/>
                                    <DataGrid x:Name="TransformGrid1"
                                              AutoGenerateColumns="False"
                                              IsReadOnly="True"
                                              HeadersVisibility="Column"
                                              MaxHeight="400"
                                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                                              CanUserResizeColumns="True"
                                              CanUserReorderColumns="False">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}" Width="Auto" MinWidth="150"/>
                                            <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="Auto" MinWidth="100"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>

                                <!-- Grid 2: Secondary Data (if applicable) -->
                                <StackPanel x:Name="TransformGrid2Panel" 
                                            Orientation="Vertical" 
                                            Margin="0,0,10,0" 
                                            MinWidth="250"
                                            Visibility="Collapsed">
                                    <TextBlock x:Name="TransformGrid2Title" 
                                               Text="Secondary Data" 
                                               FontWeight="Bold" 
                                               Margin="0,0,0,5"/>
                                    <DataGrid x:Name="TransformGrid2"
                                              AutoGenerateColumns="False"
                                              IsReadOnly="True"
                                              HeadersVisibility="Column"
                                              MaxHeight="400"
                                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                                              CanUserResizeColumns="True"
                                              CanUserReorderColumns="False">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}" Width="Auto" MinWidth="150"/>
                                            <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="Auto" MinWidth="100"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>

                                <!-- Grid 3: Result -->
                                <StackPanel x:Name="TransformGrid3Panel" 
                                            Orientation="Vertical" 
                                            MinWidth="250"
                                            Visibility="Collapsed">
                                    <TextBlock x:Name="TransformGrid3Title" 
                                               Text="Result" 
                                               FontWeight="Bold" 
                                               Margin="0,0,0,5"/>
                                    <DataGrid x:Name="TransformGrid3"
                                              AutoGenerateColumns="False"
                                              IsReadOnly="True"
                                              HeadersVisibility="Column"
                                              MaxHeight="400"
                                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                                              CanUserResizeColumns="True"
                                              CanUserReorderColumns="False">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}" Width="Auto" MinWidth="150"/>
                                            <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="Auto" MinWidth="100"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>

                                <!-- Chart: Transform Result -->
                                <Grid x:Name="TransformChartContainer" Margin="10,0,0,0" HorizontalAlignment="Stretch" MinWidth="400">
                                    <StackPanel x:Name="TransformChartPanel" 
                                                Orientation="Vertical" 
                                                Visibility="Collapsed">
                                        <lvc:CartesianChart x:Name="ChartTransformResult"
                                                            LegendLocation="Right"
                                                            Zoom="X"
                                                            Pan="X"
                                                            Hoverable="True"
                                                            Margin="20,5,10,20"
                                                            MinHeight="400">
                                            <lvc:CartesianChart.AxisX>
                                                <lvc:Axis Title="Time"/>
                                            </lvc:CartesianChart.AxisX>
                                            <lvc:CartesianChart.AxisY>
                                                <lvc:Axis Title="Value"
                                                          ShowLabels="True"/>
                                            </lvc:CartesianChart.AxisY>
                                        </lvc:CartesianChart>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </StackPanel>

                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

    </DockPanel>
</Window>
