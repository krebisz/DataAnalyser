<UserControl x:Class="DataVisualiser.UI.Charts.Controllers.SyncfusionSunburstChartController"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:controls="clr-namespace:DataVisualiser.UI.Charts.Controllers"
             xmlns:syncfusion="clr-namespace:Syncfusion.UI.Xaml.SunburstChart;assembly=Syncfusion.SfSunburstChart.WPF"
             xmlns:ui="clr-namespace:DataVisualiser.UI.Defaults"
             mc:Ignorable="d"
             d:DesignHeight="550"
             d:DesignWidth="800">
    <UserControl.Resources>
        <DataTemplate x:Key="SunburstToolTipTemplate">
            <Border Background="#CC222222" Padding="8" CornerRadius="4">
                <StackPanel>
                    <TextBlock Foreground="White"
                               FontWeight="Bold"
                               Text="{Binding PeriodText}" />

                    <TextBlock Foreground="White"
                               Text="{Binding TotalText}" />

                    <ItemsControl ItemsSource="{Binding BucketBreakdown}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                    <Border Width="10"
                                            Height="10"
                                            Background="{Binding Brush}"
                                            CornerRadius="2"
                                            Margin="0,0,6,0" />
                                    <TextBlock Foreground="White"
                                               Text="{Binding Text}" />
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>
        </DataTemplate>
    </UserControl.Resources>
    <Grid x:Name="RootGrid">
        <controls:ChartPanelController x:Name="PanelController" />

        <StackPanel x:Name="BehavioralControlsPanel"
                    Orientation="Vertical"
                    Margin="{x:Static ui:ChartUiDefaults.BehavioralControlsMargin}">
            <StackPanel Orientation="Horizontal">
                <CheckBox x:Name="ShowLegendCheckBox"
                          Content="Show Legend"
                          IsChecked="True"
                          Margin="{x:Static ui:ChartUiDefaults.LabelMargin}" />
                <Label Content="Buckets:"
                       VerticalAlignment="Center"
                       Margin="{x:Static ui:ChartUiDefaults.LabelMargin}" />
                <ComboBox x:Name="BucketCountCombo"
                          Width="60"
                          Margin="{x:Static ui:ChartUiDefaults.LabelMargin}"
                          IsEditable="False"
                          SelectionChanged="OnBucketCountSelectionChanged" />
            </StackPanel>
            <WrapPanel x:Name="SubmetricLegendPanel"
                       Margin="{x:Static ui:ChartUiDefaults.LabelMargin}" />
        </StackPanel>

        <ContentControl x:Name="ChartPresenter" Visibility="Collapsed">
            <Grid Margin="{x:Static ui:ChartUiDefaults.ChartContentMargin}">
                <Grid x:Name="SunburstHost" />
                <Canvas x:Name="RingLabelCanvas"
                        Panel.ZIndex="10"
                        IsHitTestVisible="False" />
            </Grid>
        </ContentControl>

        <!--
            We render our own tooltip via a WPF Popup so that:
            1) it appears above all overlaid sunburst rings, and
            2) we fully control the percent math (no reliance on Syncfusion tooltip DataContext).
        -->
        <Popup x:Name="HoverPopup"
               PlacementTarget="{Binding ElementName=SunburstHost}"
               Placement="RelativePoint"
               AllowsTransparency="True"
               IsHitTestVisible="False"
               StaysOpen="False"
               PopupAnimation="Fade">
            <ContentControl x:Name="HoverPopupContent"
                            ContentTemplate="{StaticResource SunburstToolTipTemplate}" />
        </Popup>
    </Grid>
</UserControl>
