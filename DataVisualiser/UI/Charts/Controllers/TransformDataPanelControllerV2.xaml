<UserControl x:Class="DataVisualiser.UI.Charts.Controllers.TransformDataPanelControllerV2"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             xmlns:controls="clr-namespace:DataVisualiser.UI.Charts.Controllers"
             xmlns:ui="clr-namespace:DataVisualiser.UI.Defaults"
             mc:Ignorable="d"
             d:DesignHeight="550"
             d:DesignWidth="1200">
    <Grid x:Name="RootGrid">
        <controls:ChartPanelController x:Name="PanelController" />

        <StackPanel x:Name="TransformContentRootPanel" Orientation="Vertical">
            <Border BorderBrush="#FFB0B0B0"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="8"
                    Margin="{x:Static ui:ChartUiDefaults.TransformOperationRowMargin}">
                <StackPanel x:Name="TransformOperationRowPanel" Orientation="Horizontal">
                    <!-- Primary Subtype Selection -->
                    <StackPanel x:Name="TransformPrimarySubtypePanel" Orientation="Vertical"
                                Margin="{x:Static ui:ChartUiDefaults.TransformPanelRightMargin}"
                                MinWidth="{x:Static ui:ChartUiDefaults.TransformPrimaryPanelMinWidth}">
                        <TextBlock Text="Primary Subtype:" FontWeight="Bold" Margin="0,0,0,5" />
                        <ComboBox x:Name="TransformPrimarySubtypeComboControl"
                                  MinWidth="{x:Static ui:ChartUiDefaults.TransformPrimaryComboMinWidth}" />
                    </StackPanel>

                    <!-- Operation Selection -->
                    <StackPanel x:Name="TransformOperationPanel" Orientation="Vertical"
                                Margin="{x:Static ui:ChartUiDefaults.TransformPanelRightMargin}"
                                MinWidth="{x:Static ui:ChartUiDefaults.TransformOperationPanelMinWidth}">
                    <TextBlock Text="Operation:" FontWeight="Bold" Margin="0,0,0,5" />
                    <ComboBox x:Name="TransformOperationComboControl"
                                  MinWidth="{x:Static ui:ChartUiDefaults.TransformOperationComboMinWidth}" />
                </StackPanel>

                    <!-- Secondary Subtype Selection -->
                    <StackPanel x:Name="TransformSecondarySubtypePanelControl" Orientation="Vertical"
                                Margin="{x:Static ui:ChartUiDefaults.TransformPanelRightMargin}"
                                MinWidth="{x:Static ui:ChartUiDefaults.TransformSecondaryPanelMinWidth}"
                                Visibility="Collapsed">
                        <TextBlock Text="Secondary Subtype:" FontWeight="Bold" Margin="0,0,0,5" />
                        <ComboBox x:Name="TransformSecondarySubtypeComboControl"
                                  MinWidth="{x:Static ui:ChartUiDefaults.TransformPrimaryComboMinWidth}" />
                    </StackPanel>

                    <!-- Compute Button -->
                    <Button x:Name="TransformComputeButtonControl"
                            Content="="
                            FontSize="{x:Static ui:ChartUiDefaults.TransformComputeButtonFontSize}"
                            FontWeight="Bold"
                            VerticalContentAlignment="Center"
                            Padding="{x:Static ui:ChartUiDefaults.TransformComputeButtonPadding}"
                            Margin="{x:Static ui:ChartUiDefaults.TransformComputeButtonMargin}"
                            IsEnabled="False" />
                </StackPanel>
            </Border>

            <Grid x:Name="TransformDataShellGrid"
                  Margin="{x:Static ui:ChartUiDefaults.TransformOperationRowMargin}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition x:Name="LeftRailColumn" Width="700" />
                    <ColumnDefinition x:Name="LeftRailSplitterColumn" Width="5" />
                    <ColumnDefinition x:Name="MainContentColumn" Width="*" />
                </Grid.ColumnDefinitions>

                <Grid x:Name="TransformLeftRailGrid" Grid.Column="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition x:Name="LeftRailHandleColumn" Width="16" />
                    </Grid.ColumnDefinitions>

                    <ScrollViewer x:Name="TransformLeftRailScrollViewer"
                                  Grid.Column="0"
                                  HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Disabled"
                                  CanContentScroll="False">
                        <StackPanel x:Name="TransformLeftRailHostPanel" Orientation="Horizontal">
                            <!-- Grid 1: Primary Data -->
                            <StackPanel x:Name="TransformGrid1Panel" Orientation="Vertical"
                                        Margin="{x:Static ui:ChartUiDefaults.TransformPanelRightMarginSmall}"
                                        MinWidth="{x:Static ui:ChartUiDefaults.TransformGridMinWidth}">
                                <TextBlock x:Name="TransformGrid1TitleControl"
                                           Text="Primary Data"
                                           FontWeight="Bold"
                                           Margin="0,0,0,5" />
                                <DataGrid x:Name="TransformGrid1Control"
                                          AutoGenerateColumns="False"
                                          IsReadOnly="True"
                                          HeadersVisibility="Column"
                                          MaxHeight="{x:Static ui:ChartUiDefaults.TransformGridMaxHeight}"
                                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                                          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                          CanUserResizeColumns="True"
                                          CanUserReorderColumns="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}"
                                                            Width="Auto"
                                                            MinWidth="{x:Static ui:ChartUiDefaults.TransformGridTimestampMinWidth}" />
                                        <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="Auto"
                                                            MinWidth="{x:Static ui:ChartUiDefaults.TransformGridValueMinWidth}" />
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>

                            <!-- Grid 2: Secondary Data (if applicable) -->
                            <StackPanel x:Name="TransformGrid2PanelControl"
                                        Orientation="Vertical"
                                        Margin="{x:Static ui:ChartUiDefaults.TransformPanelRightMarginSmall}"
                                        MinWidth="{x:Static ui:ChartUiDefaults.TransformGridMinWidth}"
                                        Visibility="Collapsed">
                                <TextBlock x:Name="TransformGrid2TitleControl"
                                           Text="Secondary Data"
                                           FontWeight="Bold"
                                           Margin="0,0,0,5" />
                                <DataGrid x:Name="TransformGrid2Control"
                                          AutoGenerateColumns="False"
                                          IsReadOnly="True"
                                          HeadersVisibility="Column"
                                          MaxHeight="{x:Static ui:ChartUiDefaults.TransformGridMaxHeight}"
                                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                                          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                          CanUserResizeColumns="True"
                                          CanUserReorderColumns="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}"
                                                            Width="Auto"
                                                            MinWidth="{x:Static ui:ChartUiDefaults.TransformGridTimestampMinWidth}" />
                                        <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="Auto"
                                                            MinWidth="{x:Static ui:ChartUiDefaults.TransformGridValueMinWidth}" />
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>

                    <ToggleButton x:Name="TransformLeftRailToggleButton"
                                  Grid.Column="1"
                                  Width="16"
                                  HorizontalAlignment="Stretch"
                                  VerticalAlignment="Stretch"
                                  ToolTip="Collapse or expand the left rail"
                                  Content="&lt;"
                                  FontWeight="Bold"
                                  Padding="0" />
                </Grid>

                <GridSplitter x:Name="TransformLeftRailSplitter"
                              Grid.Column="1"
                              Width="5"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch" />

                <Grid x:Name="TransformMainContentGrid" Grid.Column="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Grid 3: Result -->
                    <StackPanel x:Name="TransformGrid3PanelControl"
                                Orientation="Vertical"
                                Grid.Column="0"
                                HorizontalAlignment="Left"
                                MinWidth="{x:Static ui:ChartUiDefaults.TransformGridMinWidth}"
                                Visibility="Collapsed">
                        <TextBlock x:Name="TransformGrid3TitleControl"
                                   Text="Result"
                                   FontWeight="Bold"
                                   Margin="0,0,0,5" />
                        <DataGrid x:Name="TransformGrid3Control"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  ColumnWidth="SizeToCells"
                                  HorizontalAlignment="Left"
                                  MaxHeight="{x:Static ui:ChartUiDefaults.TransformGridMaxHeight}"
                                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                                  CanUserResizeColumns="True"
                                  CanUserReorderColumns="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}"
                                                    Width="SizeToCells"
                                                    MinWidth="{x:Static ui:ChartUiDefaults.TransformGridTimestampMinWidth}" />
                                <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="SizeToCells"
                                                    MinWidth="{x:Static ui:ChartUiDefaults.TransformGridValueMinWidth}" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>

                    <!-- Chart: Transform Result -->
                    <Grid x:Name="TransformChartContainerControl"
                          Grid.Column="1"
                          Margin="{x:Static ui:ChartUiDefaults.TransformChartContainerMargin}"
                          HorizontalAlignment="Stretch"
                          MinWidth="{x:Static ui:ChartUiDefaults.TransformChartContainerMinWidth}">
                        <StackPanel x:Name="TransformChartContentPanelControl"
                                    Orientation="Vertical"
                                    HorizontalAlignment="Stretch"
                                    Visibility="Collapsed">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <lvc:CartesianChart x:Name="ChartTransformResultControl"
                                                    Grid.Column="0"
                                                    LegendLocation="None"
                                                    Zoom="{x:Static ui:ChartUiDefaults.DefaultZoom}"
                                                    Pan="{x:Static ui:ChartUiDefaults.DefaultPan}"
                                                    Hoverable="{x:Static ui:ChartUiDefaults.DefaultHoverable}"
                                                    Width="{Binding ActualWidth, ElementName=TransformChartContainerControl}"
                                                    Margin="{x:Static ui:ChartUiDefaults.ChartContentMargin}"
                                                    MinHeight="{x:Static ui:ChartUiDefaults.ChartMinHeight}">
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Title="{x:Static ui:ChartUiDefaults.AxisTitleTime}" />
                                    </lvc:CartesianChart.AxisX>
                                    <lvc:CartesianChart.AxisY>
                                        <lvc:Axis Title="{x:Static ui:ChartUiDefaults.AxisTitleValue}"
                                                  ShowLabels="True" />
                                    </lvc:CartesianChart.AxisY>
                                </lvc:CartesianChart>

                                <Border Grid.Column="1"
                                        Background="#CC111111"
                                        CornerRadius="4"
                                        Padding="6"
                                        Margin="0,10,10,0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Top">
                                    <StackPanel Orientation="Vertical">
                                        <ItemsControl x:Name="TransformLegendItemsControl"
                                                      HorizontalAlignment="Left">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <StackPanel />
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <ToggleButton IsChecked="{Binding IsVisible, Mode=TwoWay}"
                                                                  Click="OnLegendItemToggle"
                                                                  Background="Transparent"
                                                                  BorderThickness="0"
                                                                  Padding="2"
                                                                  HorizontalContentAlignment="Left">
                                                        <StackPanel Orientation="Horizontal"
                                                                    HorizontalAlignment="Left">
                                                            <Rectangle Width="12"
                                                                       Height="12"
                                                                       Fill="{Binding Stroke}"
                                                                       Stroke="White"
                                                                       StrokeThickness="0.5"
                                                                       Margin="0,0,6,0" />
                                                            <TextBlock Text="{Binding Title}"
                                                                       Foreground="White"
                                                                       TextAlignment="Left" />
                                                        </StackPanel>
                                                    </ToggleButton>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                        <CheckBox x:Name="TransformMinMaxLinesCheckBox"
                                                  Margin="2,6,2,0"
                                                  Foreground="White"
                                                  Content="Show Min/Max Lines" />
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Grid>
        </StackPanel>
    </Grid>
</UserControl>
