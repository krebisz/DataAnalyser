<UserControl x:Class="DataVisualiser.UI.Controls.TransformDataPanelController"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             xmlns:controls="clr-namespace:DataVisualiser.UI.Controls"
             xmlns:ui="clr-namespace:DataVisualiser.UI.Defaults"
             mc:Ignorable="d"
             d:DesignHeight="550"
             d:DesignWidth="1200">
    <Grid x:Name="RootGrid">
        <controls:ChartPanelController x:Name="PanelController" />

        <StackPanel x:Name="TransformContentRootPanel" Orientation="Vertical">
            <StackPanel x:Name="TransformOperationRowPanel" Orientation="Horizontal"
                        Margin="{x:Static ui:ChartUiDefaults.TransformOperationRowMargin}">
                <!-- Primary Subtype Selection -->
                <StackPanel x:Name="TransformPrimarySubtypePanel" Orientation="Vertical"
                            Margin="{x:Static ui:ChartUiDefaults.TransformPanelRightMargin}"
                            MinWidth="{x:Static ui:ChartUiDefaults.TransformPrimaryPanelMinWidth}">
                    <TextBlock Text="Primary Subtype:" FontWeight="Bold" Margin="0,0,0,5" />
                    <ComboBox x:Name="TransformPrimarySubtypeComboControl"
                              MinWidth="{x:Static ui:ChartUiDefaults.TransformPrimaryComboMinWidth}" />
                </StackPanel>

                <!-- Operation Selection -->
                <StackPanel x:Name="TransformOperationPanel" Orientation="Vertical"
                            Margin="{x:Static ui:ChartUiDefaults.TransformPanelRightMargin}"
                            MinWidth="{x:Static ui:ChartUiDefaults.TransformOperationPanelMinWidth}">
                    <TextBlock Text="Operation:" FontWeight="Bold" Margin="0,0,0,5" />
                    <ComboBox x:Name="TransformOperationComboControl"
                              MinWidth="{x:Static ui:ChartUiDefaults.TransformOperationComboMinWidth}">
                        <ComboBoxItem Content="Logarithm" Tag="Log" />
                        <ComboBoxItem Content="Square Root" Tag="Sqrt" />
                        <ComboBoxItem Content="Add (+)" Tag="Add" />
                        <ComboBoxItem Content="Subtract (-)" Tag="Subtract" />
                        <ComboBoxItem Content="Divide (/)" Tag="Divide" />
                    </ComboBox>
                </StackPanel>

                <!-- Secondary Subtype Selection -->
                <StackPanel x:Name="TransformSecondarySubtypePanelControl" Orientation="Vertical"
                            Margin="{x:Static ui:ChartUiDefaults.TransformPanelRightMargin}"
                            MinWidth="{x:Static ui:ChartUiDefaults.TransformSecondaryPanelMinWidth}"
                            Visibility="Collapsed">
                    <TextBlock Text="Secondary Subtype:" FontWeight="Bold" Margin="0,0,0,5" />
                    <ComboBox x:Name="TransformSecondarySubtypeComboControl"
                              MinWidth="{x:Static ui:ChartUiDefaults.TransformPrimaryComboMinWidth}" />
                </StackPanel>

                <!-- Compute Button -->
                <Button x:Name="TransformComputeButtonControl"
                        Content="="
                        FontSize="{x:Static ui:ChartUiDefaults.TransformComputeButtonFontSize}"
                        FontWeight="Bold"
                        Padding="{x:Static ui:ChartUiDefaults.TransformComputeButtonPadding}"
                        Margin="{x:Static ui:ChartUiDefaults.TransformComputeButtonMargin}"
                        IsEnabled="False" />
            </StackPanel>

            <!-- Data Grids -->
            <StackPanel x:Name="TransformDataGridsPanel" Orientation="Horizontal"
                        Margin="{x:Static ui:ChartUiDefaults.TransformOperationRowMargin}">
                <!-- Grid 1: Primary Data -->
                <StackPanel x:Name="TransformGrid1Panel" Orientation="Vertical"
                            Margin="{x:Static ui:ChartUiDefaults.TransformPanelRightMarginSmall}"
                            MinWidth="{x:Static ui:ChartUiDefaults.TransformGridMinWidth}">
                    <TextBlock x:Name="TransformGrid1TitleControl"
                               Text="Primary Data"
                               FontWeight="Bold"
                               Margin="0,0,0,5" />
                    <DataGrid x:Name="TransformGrid1Control"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              MaxHeight="{x:Static ui:ChartUiDefaults.TransformGridMaxHeight}"
                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                              CanUserResizeColumns="True"
                              CanUserReorderColumns="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}"
                                                Width="Auto"
                                                MinWidth="{x:Static ui:ChartUiDefaults.TransformGridTimestampMinWidth}" />
                            <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="Auto"
                                                MinWidth="{x:Static ui:ChartUiDefaults.TransformGridValueMinWidth}" />
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>

                <!-- Grid 2: Secondary Data (if applicable) -->
                <StackPanel x:Name="TransformGrid2PanelControl"
                            Orientation="Vertical"
                            Margin="{x:Static ui:ChartUiDefaults.TransformPanelRightMarginSmall}"
                            MinWidth="{x:Static ui:ChartUiDefaults.TransformGridMinWidth}"
                            Visibility="Collapsed">
                    <TextBlock x:Name="TransformGrid2TitleControl"
                               Text="Secondary Data"
                               FontWeight="Bold"
                               Margin="0,0,0,5" />
                    <DataGrid x:Name="TransformGrid2Control"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              MaxHeight="{x:Static ui:ChartUiDefaults.TransformGridMaxHeight}"
                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                              CanUserResizeColumns="True"
                              CanUserReorderColumns="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}"
                                                Width="Auto"
                                                MinWidth="{x:Static ui:ChartUiDefaults.TransformGridTimestampMinWidth}" />
                            <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="Auto"
                                                MinWidth="{x:Static ui:ChartUiDefaults.TransformGridValueMinWidth}" />
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>

                <!-- Grid 3: Result -->
                <StackPanel x:Name="TransformGrid3PanelControl"
                            Orientation="Vertical"
                            MinWidth="{x:Static ui:ChartUiDefaults.TransformGridMinWidth}"
                            Visibility="Collapsed">
                    <TextBlock x:Name="TransformGrid3TitleControl"
                               Text="Result"
                               FontWeight="Bold"
                               Margin="0,0,0,5" />
                    <DataGrid x:Name="TransformGrid3Control"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              MaxHeight="{x:Static ui:ChartUiDefaults.TransformGridMaxHeight}"
                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                              CanUserResizeColumns="True"
                              CanUserReorderColumns="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Timestamp" Binding="{Binding Timestamp}"
                                                Width="Auto"
                                                MinWidth="{x:Static ui:ChartUiDefaults.TransformGridTimestampMinWidth}" />
                            <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="Auto"
                                                MinWidth="{x:Static ui:ChartUiDefaults.TransformGridValueMinWidth}" />
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>

                <!-- Chart: Transform Result -->
                <Grid x:Name="TransformChartContainerControl"
                      Margin="{x:Static ui:ChartUiDefaults.TransformChartContainerMargin}"
                      HorizontalAlignment="Stretch"
                      MinWidth="{x:Static ui:ChartUiDefaults.TransformChartContainerMinWidth}">
                    <StackPanel x:Name="TransformChartContentPanelControl"
                                Orientation="Vertical"
                                Visibility="Collapsed">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <lvc:CartesianChart x:Name="ChartTransformResultControl"
                                                Grid.Column="0"
                                                LegendLocation="None"
                                                Zoom="{x:Static ui:ChartUiDefaults.DefaultZoom}"
                                                Pan="{x:Static ui:ChartUiDefaults.DefaultPan}"
                                                Hoverable="{x:Static ui:ChartUiDefaults.DefaultHoverable}"
                                                Margin="{x:Static ui:ChartUiDefaults.ChartContentMargin}"
                                                MinHeight="{x:Static ui:ChartUiDefaults.ChartMinHeight}">
                                <lvc:CartesianChart.AxisX>
                                    <lvc:Axis Title="{x:Static ui:ChartUiDefaults.AxisTitleTime}" />
                                </lvc:CartesianChart.AxisX>
                                <lvc:CartesianChart.AxisY>
                                    <lvc:Axis Title="{x:Static ui:ChartUiDefaults.AxisTitleValue}"
                                              ShowLabels="True" />
                                </lvc:CartesianChart.AxisY>
                            </lvc:CartesianChart>

                            <Border Grid.Column="1"
                                    Background="#CC111111"
                                    CornerRadius="4"
                                    Padding="6"
                                    Margin="0,10,10,0"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Top">
                                <ItemsControl x:Name="TransformLegendItemsControl"
                                              HorizontalAlignment="Left">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <ToggleButton IsChecked="{Binding IsVisible, Mode=TwoWay}"
                                                          Click="OnLegendItemToggle"
                                                          Background="Transparent"
                                                          BorderThickness="0"
                                                          Padding="2"
                                                          HorizontalContentAlignment="Left">
                                                <StackPanel Orientation="Horizontal"
                                                            HorizontalAlignment="Left">
                                                    <Rectangle Width="12"
                                                               Height="12"
                                                               Fill="{Binding Stroke}"
                                                               Stroke="White"
                                                               StrokeThickness="0.5"
                                                               Margin="0,0,6,0" />
                                                    <TextBlock Text="{Binding Title}"
                                                               Foreground="White"
                                                               TextAlignment="Left" />
                                                </StackPanel>
                                            </ToggleButton>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Border>
                        </Grid>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </StackPanel>
    </Grid>
</UserControl>
